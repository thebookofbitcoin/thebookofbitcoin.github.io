<!DOCTYPE html>
<html lang="en">
  <head>
    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Book of Bitcoin</title>
  </head>
  <body>
    <header class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header"><a class="navbar-brand" href="../../index.html"><i class="fa fa-bookmark"></i><span>&#160;The Book of Bitcoin</span></a></div>
      </div>
    </header>
    <div class="container" id="article">
      <div class="row">
        <div class="col-md-8">
          <div class="content"><h1 id="bitcoin-core-block-exchange-protocol">Bitcoin Core Block Exchange Protocol</h1>
<p>Bitcoin nodes sync blocks with each other using the <strong>block exchange protocol</strong>.</p>
<p>The protocol is based on a series of steps. When first connecting to another node, a node will send its version and receive a version message in response. The node will then send the first node that it completes this exchange with some hashes of blocks that it knows about and ask to be caught up on recent blocks via the request <em>getblocks</em>. The hashes of blocks that it sends are spaced out, and there is always a common block to be caught up from: the starting block of the Blockchain, also known as the genesis block.</p>
<p>Nodes catch up out of date nodes by sending them a range of block hashes, through the <em>inv</em> message that lists a menu of missing block hashes that it can provide. The out of date node then sends a <em>getdata</em> message that pulls down the actual block data. To avoid abuse, nodes reject repeated <em>getdata</em> calls for the same block.</p>
<p>Out of date nodes are pulled up to date through a batched sending process. This process sends all the blocks to the out of date node, in pages, with the out of date node interactively asking for more pages as it processes the records. Interruptions in the process reset the sync until the next new block is received via broadcast.</p>
</div>
        </div>
        <div class="col-md-4">
          <nav class="navbar navbar-default">
            <div class="container-fluid">
              <div class="navbar-header"><a class="btn btn-default navbar-btn" href="https://github.com/thebookofbitcoin/thebookofbitcoin.github.io/edit/master/content/network/block_exchange_protocol.md"><i class="fa fa-github">&#160;</i><span>Edit</span></a>
                <p class="navbar-right navbar-text"><span>Text licensed </span><a class="navbar-link" href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CC0</a></p>
              </div>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </body>
</html>